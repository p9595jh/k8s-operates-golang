# k8s-operates-golang

## 개요

- `operator`가 `operatable`을 오퍼레이팅

## Operatable

- API를 통해 시간을 설정한 job을 생성하면 해당 시간동안 작업 진행
- 한 번에 하나의 job만 돌릴 수 있음

## Operator

- `kubebuilder`를 이용하여 생성된 오퍼레이터
- `Operatable`에 대한 CRD를 정의하고 CR을 통해 컨트롤러에서 오퍼레이팅을 진행
- API를 통해 job 생성 요청을 받으면 내부 큐에 저장하고, 컨트롤러에서 일정 주기로 반복하며 큐로부터 작업 요청을 꺼내서 처리
- 조건에 따라서 행동
  - 큐의 요청 개수가 0개이고 처리 중인 작업이 없으면 파드 개수를 `minSize`만큼 낮춤
  - 큐의 요청 개수가 0보다 크고 처리 중인 작업이 없으면 파드 개수를 `min(maxSize, 요청 개수)`만큼 늘린 뒤 작업 할당
  - 큐의 요청 개수가 0보다 크고 처리 중인 작업이 `maxSize`이면 빈 파드가 생길 때까지 대기
- 파드에 작업을 할당할 때는 파드의 IP를 사용
